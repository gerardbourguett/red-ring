---
// Importar dependencias necesarias
import { Button } from "@nextui-org/react";
import Layout from "../layouts/Layout.astro";
import { supabase } from "../lib/supabase";
import StreamGrid from "./react/StreamGrid";
import { CURRENT_YEAR } from "../data/constants";
import SocialShare from "./react/SocialShare";

// Estado inicial de datos
let data: any[] = [];
let error = null;

// Función para obtener datos de Supabase
async function fetchLiveStreams() {
  try {
    const { data: liveData, error: fetchError } = await supabase
      .from("live")
      .select("*");
    if (fetchError) throw fetchError;
    data = liveData ?? [];
  } catch (err) {
    error = err.message;
    console.error("Error fetching live streams:", error);
  }
}

// Fetch inicial de datos
await fetchLiveStreams();

// Configuración de intervalo para actualizar datos cada minuto
setInterval(async () => {
  await fetchLiveStreams();
}, 1000);
---

<Layout title={`#${CURRENT_YEAR + 1}Live | Livestreams`}>
  <main>
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 max-w-screen-lg">
      <h1
        class="text-4xl sm:text-5xl md:text-6xl font-bold dark:text-white mb-6 sm:mb-8 md:mb-12 text-center tracking-tight"
      >
        Live Streams
      </h1>
      <p
        class="text-base sm:text-lg text-center text-gray-700 dark:text-gray-300"
      >
        Transmissions will change as midnight approaches in some territories
      </p>
    </div>
    <div class="space-y-4 mb-8">
      <SocialShare
        url="https://nye.today/watch"
        title="New Year Eve livestreams around the world"
      />
      <StreamGrid events={data ?? []} client:load />
    </div>
  </main>
</Layout>
